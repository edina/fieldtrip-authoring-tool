<!DOCTYPE html>

<html>
<head>
  <meta charset="utf-8">
  <title>Spatial Memories Author</title>
  <!-- disable iPhone inital scale -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">


  <link rel="stylesheet" type="text/css" href="css/ext/bootstrap.css">
  <link rel="stylesheet" type="text/css" href="css/ext/swipebox.css">
  <link href="css/ext/jPaginator.css" rel="stylesheet" type="text/css">

  <link href="css/jquery-ui-1.9.1.custom.min.css" rel="stylesheet" type="text/css">
  <link href="css/former.css" rel="stylesheet" type="text/css">
  <link href="css/bootstrap-responsive.min.css" rel="stylesheet" type="text/css">
  <link href="css/DT_bootstrap.css" rel="stylesheet" type="text/css">
  <link href="css/media_queries.css" rel="stylesheet" type="text/css">
  <link href="css/jquery.snippet.min.css" rel="stylesheet" type="text/css">

  <style>
    [class^="icon-"], [class*=" icon-"] {
      background-image: url(img/glyphicons-halflings.png)
    }
  </style>

  <!--[if IE]>
    <script type="text/javascript">
      // Dummy console for problems in IE
      var console = {
        log: function (msg) { },
        warn: function (msg) { }
      };
    </script>
  <![endif]-->

  <!--<script type="text/javascript" src="https://getfirebug.com/firebug-lite-debug.js"></script>-->
  <script type="text/javascript" src="js/ext/jquery.js"></script>
  <script type="text/javascript" src="js/ext/jquery-ui.js"></script>
  <script type="text/javascript" src="js/ext/jqueryui-timepicker-addon.js"></script>
  <script type="text/javascript" src="js/ext/jquery.ui.touch-punch.min.js"></script>
  <script type="text/javascript" src="js/ext/snippet.js"></script>
  <script type="text/javascript" src="js/ext/jquery.dataTables.js"></script>
  <script type="text/javascript" src="js/DT_bootstrap.js"></script>
  <script type="text/javascript" src="js/ext/proj4js.js"></script>
  <script type="text/javascript" src="js/ext/audiojs.js"></script>
  <script type="text/javascript">
    Proj4js.defs["EPSG:27700"] = "+proj=tmerc +lat_0=49 +lon_0=-2 +k=0.9996012717 +x_0=400000 +y_0=-100000 +ellps=airy +datum=OSGB36 +units=m +no_defs";
  </script>
  <script type="text/javascript" src="js/ext/openlayers.js"></script>
  <script type="text/javascript" src="js/ext/d3.js"></script>
  <script type="text/javascript" src="js/ext/bootstrap.js"></script>
  <script type="text/javascript" src="js/ext/jquery.swipebox.js"></script>
  <script type="text/javascript" src="js/ext/jPaginator.js"></script>
  <script type="text/javascript" src="js/openlayers/GPXExt.js"></script>

  <script type="text/javascript" src="js/former/jquery.former.accessibility.js"></script>
  <script type="text/javascript" src="js/former/jquery.former.pcapi.js"></script>
  <script type="text/javascript" src="js/former/jquery.former.functions.js"></script>
  <script type="text/javascript" src="js/former/jquery.former.locationfile.js"></script>
  <script type="text/javascript" src="js/former/jquery.former.mapviewer.js"></script>
  <script type="text/javascript" src="js/former/jquery.former.animator.js"></script>
  <script type="text/javascript" src="js/former/jquery.former.animatorviewer.js"></script>
  <script type="text/javascript" src="js/former/jquery.former.statistics.js"></script>
  <script type="text/javascript" src="js/former/jquery.former.core.js"></script>
  <!--<script type="text/javascript" src="js/former/jquery.former.storage.js"></script>-->
  <script type="text/javascript" src="js/former/jquery.former.action.js"></script>
  <script type="text/javascript" src="js/former/jquery.former.searcher.js"></script>
  <script type="text/javascript" src="js/former/jquery.former.renderer.js"></script>
  <script type="text/javascript" src="js/former/jquery.former.text.js"></script>
  <script type="text/javascript" src="js/former/jquery.former.textarea.js"></script>
  <script type="text/javascript" src="js/former/jquery.former.checkbox.js"></script>
  <script type="text/javascript" src="js/former/jquery.former.radio.js"></script>
  <script type="text/javascript" src="js/former/jquery.former.option.js"></script>
  <script type="text/javascript" src="js/former/jquery.former.photo.js"></script>
  <script type="text/javascript" src="js/former/jquery.former.audio.js"></script>
  <script type="text/javascript" src="js/former/jquery.former.capture.js"></script>
  <script type="text/javascript" src="js/former/jquery.former.optionsform.js"></script>
</head>

<body>
  <div id="wrap">
    <div class="navbar navbar-inverse navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container-fluid">
          <button type="button" class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="brand" role="banner" href="#">Spatial Memories Author</a>
          <div class="nav-collapse collapse">
            <ul class="nav" role="tablist" id="mainmenu"></ul>
            <div class="navbar-text pull-right" id="user-section">
              <button class="btn btn-primary btn-small loginbutton" role="button" tabindex="0" aria-label="Login using your dropbox account">Login</button>
              <button class="btn btn-primary btn-small logoutbutton" role="button" tabindex="0" style="display: none">Logout</button>
            </div>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>

    <div class="container-fluid" role="main" id="main">
      <div class="row-fluid">
        <div class="span10 offset1">
          <!--div class="hero-unit"-->
            <div class="navbar">
              <div class="navbar-inner" id="editmenu" style="display: none;">
                <div class="container">
                  <a class="brand" href="#">Edit menu</a>
                </div>
              </div>
            </div>
            <div id="f_title"></div>
            <div id="form-content"></div>
            <div id="home-content" aria-hidden="false"></div>
            <!-- map-content row -->
            <div class="row">
              <div id="map-content" style="display: none" aria-hidden="true">
                <div id="map_canvas"></div>
                <br><br>
                <div class="records panel">
                  <div id="filter-area">
                    <button id="filter-records" class="btn">Get Tracks</button>
                    <!-- Add two hidden values for using prepareFiltersString -->
                    <input type="hidden" name="date-start" id="date-start" value=""/>
                    <input type="hidden" name"by-editor" id="by-editor" value=""/>
                  </div>
                  <div id="memories-container" style="clear: both;" >
                    <table cellpadding="0" cellspacing="0" border="0" class="table table-striped table-bordered" id="memories" tabindex="0" aria-label="List of tracks recorded. Use up and down arrow to move between records. Use Enter to edit the name or the description of each record. Use plus or minus for expanding the memories associated to the track" role="treegrid">
                      <caption>List of tracks</caption>
                      <thead>
                        <tr>
                          <th class="details-control sorting_disabled" aria-hidden="true"></th>
                          <th>Name</th>
                          <th>Description</th>
                          <th>Date</th>
                          <th>Edit</th>
                        </tr>
                      </thead>
                    </table>
                  </div>
                </div>
                <div id="location-control" class="utilities panel" style="display: none;">
                  <input name="location-lat" type="hidden" value=""/>
                  <input name="location-lon" type="hidden" value=""/>
                  <h4>Create a location file</h4>
                  <ol>
                    <li>Search for a location:<br/>
                      <input name="location" type="text" placeholder="Location" value=""/>
                    </li>
                    <li>Set a radius around that location or create an area in the map:<br/>
                      <input name="radius" type="text" placeholder="Radius" value=""/>
                    </li>
                    <li>
                      <button id="create-location" class="btn btn-primary" type="button" role="button">Create</button>
                    </li>
                  </ol>


                  <div id="location-dialog" style="display:none"></div>
                </div>
              </div>
            </div>
            <!-- end map-content row -->
            <!-- CONTENT FOR TRACK ANIMATOR -->
            <div class="row">
              <div id="animator-content" class="container-fluid" style="display: none" aria-hidden="true">
                <div class="row">
                  <div id="animator-map_canvas" style="background-color: #eee;"></div>
                </div>
                <div id="animation-control" class="row">
                    <div class="btn-group">
                      <button class="get-tracks btn">Get Tracks</button>
                      <button disabled id="track-animate" class="track-animate btn" title="Animate track" aria-label="Animate the track path">Animate <i class="icon-play"></i></button>
                      <button id="track-pause-animate" style="display:none;" class="track-pause-animate btn" title="Pause track animate" aria-label="Pause track animation">Pause Animation <i class="icon-pause"></i></button>
                    </div>
                </div>
                <div class="row">
                  <div class="span12">
                    <div>

                      <table id="animator-myTable" class="table" tabindex="0">
                        <thead>
                          <tr>
                            <th>Name</th>
                            <th>Description</th>
                            <th>Date</th>
                            <th>Number of POIs</th>
                          </tr>
                        </thead>
                        <tbody>
                        </tbody>
                      </table>

                    </div>
                  </div>
                </div>
              </div>
            </div><!-- END CONTENT FOR TRACK ANIMATOR -->
            <div class="row">
              <div id="aria-notification" aria-live="assertive" tabindex="-1"></div>
            </div>
          <!--/div-->
        </div><!--/span-->
      </div><!--/row-->
    </div><!--/.fluid-container-->
    <div id="push"></div>
  </div><!--/wrap-->
  <footer id="#footer">
    <div class="container">
      <div class="edina-logo">
      &copy;&nbsp;<a href="http://edina.ac.uk" target="blank"><img src="img/edina.png"></a>
      </div>
      <div class="funders-logo">
        <img src="img/funders-logo.jpg">
      </div>
    </div>
  </footer>

  <div id="dialog-map" title="Map Viewer"></div>

  <div id="dialog-login" title="Login">
    <p>
      <ul>
        <li><a href="javascript:void(0);" class="redirect-me" id="dropbox"><img src="img/dropbox.png" alt="Dropbox" /></a></li>
        <li><a href="javascript:void(0);" class="redirect-me" id="local">Local Provider</a></li>
      </ul>
    </p>
  </div>

  <div id="dialog-upload" title="Upload tiles">
    <form id="fileupload" name="fileupload" enctype="multipart/form-data" method="post">
      <fieldset>
        <input type="file" name="fileselect" id="fileselect"></input>
        <input id="uploadbutton" type="button" value="Upload Tiles" class="btn" />
      </fieldset>
    </form>
  </div>

  <div id="loader">
    <img src="css/images/ajax-loader.gif" alt="Loading data">
  </div>

  <script type="text/javascript">
    //var map, oTable;

    var provider = 'dropbox';

    $(document).ready(function(){

      $("#map_canvas").width($(".span10").width());
      $("#map_canvas").height(0.6*$(window).height());

      $( "#dialog-map" ).dialog({
        autoOpen: false,
        height: 0.90*$(window).height(),
        width: 0.90*$(window).width(),
        modal: false
      });

      $("#dialog-login").dialog({
        autoOpen: false,
        modal: false
      });

      $("#dialog-upload").dialog({
        autoOpen: false,
        modal: false
      });

      $("#dialog-local-login").dialog({
        autoOpen: false,
        modal: false
      });

      // Get the authentication parameters
      var uid = getParam('uid', $(location).attr('href'));
      var token = getParam('oauth_token', $(location).attr('href'));

      // Load the home and attack login event
      $.ajax({
        url: "home.html",
        dataType: "html",
        success: function(data){
          $("#home-content").append(data);
          $(".loginbutton").click(function(evt){
            // If not authenticated yet
            if(uid == 0){
              evt.preventDefault();
              var callback = $(location).attr('href');
              var url = "/1.3/pcapi/auth/"+provider+"?callback=" + callback;
              localStorage.setItem("provider", provider);

              // Redirect the user to the dropbox oauth page
              $.getJSON(url, function(data) {
                $(location).attr('href', data.url);
              });
            }
          });

          $(".logoutbutton").click(function(evt){
            url = $(location).attr('href');
            home = url.split('?')[0];
            $(location).attr('href', home);
          });
        }
      });

      if(uid != 0){
        initialize_app(token, localStorage.getItem("provider"));
        $("#my-records").trigger('click');
      }

      if(screen.width < 768){
        $("#fat-menu").hide();
        $("#size-screen").hide();
        $("#edit-buttons").hide();
        $(".btn").removeClass('btn-large').addClass('btn-small');
      }else if(screen.width <= 1200){
        $(".btn").removeClass('btn-large');
      }

    });

    function initialize_app(oauth, provider){
      var options = {
        version: "1.3",
        provider: provider,
        mainmenu_id: "mainmenu",
        editmenu_id: "editmenu",
        sizes: ["240x320", "320x480", "480x800", "600x1024"],
        form_elements_id: "elements",
        oauth: oauth,
        choices: {
          "textAction": ["text", "Text"],
          "rangeAction": ["range", "Range"],
          "textareaAction": ["textarea", "Text Area"],
          "checkboxAction": ["checkbox", "Multiple Choice Selector"],
          "radioAction": ["radio", "Single Choice Selector"],
          "selectAction": ["select", "Drop down Selector"],
          "photoAction": ["image", "Image Capture"],
          "audioAction": ["audio", "Audio Capture"]
        }
      };

      $('.loginbutton').hide();
      $('.logoutbutton').show();
      $("#form-content").buildformer(options);
    }

    function getParam( name,href ){
      name = name.replace(/[\[]/,"\\\[").replace(/[\]]/,"\\\]");
      var regexS = "[\\?&]"+name+"=([^&#]*)";
      var regex = new RegExp( regexS );
      var results = regex.exec( href );
      if( results == null )
        return "";
      else
        return decodeURIComponent(results[1].replace(/\+/g, " "));
    }

  </script>

</body>
</html>
